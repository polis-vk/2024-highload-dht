# Емельянов Виталий, 3 этап

## Запись

Нагрузка на запись производится тем же, скриптом, что использовался на этапах 1, 2
в 1 поток, 64 подключения, 20'000 RPS (точка разладки ~25'000 RPS)

[Логи wrk2](wrk2_put.txt)

### Alloc

[Профиль по аллокациям](put_alloc.html)

Нетрудно заметить, что появилась большая часть сэмплов, связанная с работой HttpClient.
В частности, всего ~66% сэмплов связано с выделением буффера для ResponseReader, суммарно
же с работой HttpClient связано ~75% сэмплов.

### ЦПУ

[Профиль ЦПУ](put_cpu.html)

Ожидаемо, вслед за повышением количества аллокаций выросла и работа GC (c ~7% сэмплов до ~12%).
С работой HttpClient связано ~19% сэмплов.

### Блокировки

[Профиль блокировок](put_lock.html)

Изменений по блокировкам не наблюдается

## Чтение

Нагрузка на запись производится тем же, скриптом, что использовался на этапах 1, 2
в 1 поток, 64 подключения, 100'000 RPS (точка разладки ~120'000 RPS).
Такой резкий сдвиг точки разладки связан с тем, что, во-первых, снизился общий объем данных
(раньше он составлял ~6 ГиБ, теперь ~4), так еще и на каждую из 3х нод приходится лишь ее часть
(~1.33 ГиБ), что сокращает время поиска.

[Логи wrk2](wrk2_get.txt)

Профили изменились полностью аналогично тому, как они изменились при работе на запись
(с отличием лишь в конкретных процентах сэмплов, поскольку полезная нагрузка идет другого рода),
поскольку логика измененная логика работы одинаково затрагивает и чтение и запись, т.е. пересылка
запросов выполняется одинаково, а непосредственная логика работы не менялась.