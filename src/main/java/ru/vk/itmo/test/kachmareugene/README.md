# Этап первый.

Итак в этом этапе необходимо: 
 - было найти точки разладки для операций put и get.
 - профильнуть для put и get при нагрузке

Компу на котором проводится тестирование уже ~12 лет. 

Точка разладки для put лежит где-то в диапазоне от 8к-11к.
Если обратить внимение на RPC, то в 2х замерах у меня он приближен к тому, который и должен быть.

[первый замер](./results/loading_with_put_good.txt)
[второй замер](./results/loading_with_put_bad1.txt)

Но вот если посмотреть на время отклика, на 95 персентиль, к примеру.
Уже будет другая картина.

Ответ от сервера длиной в 611.327ms звучит очень грустно, и уже говорит нам, что что-то пошло не так.
В свою очередь, при втором замере 172ms может и хорошее время, смотря что мы считаем хорошим;)

Поэтому могу сделать вывод, что точка разладки put находится между 2мя приведенными замерами.

Точка разладки для get лежит от в диапазоне от 4к до 6к. Перед get запускал скрипт, чтобы база проинициализировалась.

[первый замер](./results/loading_with_get_good.txt)
[второй замер](./results/loading_with_get_bad.txt)

## Профилирование.
1 - PUT

[ALLOC](./results/allocput.html) - аллокация была при записи SSTable'ов в память. Аж 12%. 
Ну чтож, возможно, стоит рассмотреть другой вид хранения данных. Или как-то сжимать данные перед записью 

Но со сжатием в любом случае надо быть аккуратным, так как по асимптотике можем просесть сильно.

Вторая по частоте(7%) была sendResponse->Response.toBytes.

На мой взгляд это некая сериализация данных перед отправкой, поэтому особо это пофиксить не получиться. Кроме как изменить способ передачи данных и отказаться от http))

[CPU](./results/cpuput.html) - 20% было потрачено на readRequest. То есть cpu простаивал в режиме ожидания новых запросов и чтения их. 


2 - GET

[ALLOC](./results/allocget.html) - сложно выделить место, где однозначно больше всего аллоков, она в среднем занмают по 10%.

[CPU](./results/cpuget.html) - аж 60% происходило сравнение memsegm'ов. Есть смысл, возможно, добавить эвристику для сравния или распаралеллить эту задачу.
 
