# Stage 3

## PUT TEST

```shell
./wrk -d 30 -t 8 -c 64 -R 70000 -L -s src/main/java/ru/vk/itmo/test/reshetnikovaleksei/lua/put.lua  http://localhost:8080 

 Latency |    было  |  стало
 50.000% |   2.01ms | 11.99s   
 75.000% | 149.12ms | 15.50s   
 90.000% | 283.90ms | 24.87s   
 99.000% | 365.05ms | 25.05s   
 99.900% | 371.97ms | 25.10s   
 99.990% | 374.78ms | 26.08s   
 99.999% | 376.58ms | 26.10s   
100.000% | 377.09ms | 26.10s   
```

[Allocation profile](put_alloc.html)
[CPU profile](put_cpu.html)

В целом доли такие же, как и в предыдущем этапе, за исключением появления походов через `HttpClient`, которые занимает значительную
долю ресурсов в рамках аллокаций и cpu

- 46.32% аллокаций занимает `HttpClient` (перенаправление запроса), 2% аллокаций занимает обратботка запроса в текущем инстансе
- 12.92% cpu занимает `HtppClient`, 0.67% cpu занимает обработать запрос в текущем инстансе

## GET TEST

```shell
./wrk -d 30 -t 8 -c 64 -R 75000 -L -s src/main/java/ru/vk/itmo/test/reshetnikovaleksei/lua/get.lua http://localhost:8080 

 Latency |    было  |  стало
 50.000% |   1.64ms | 16.72s 
 75.000% |   2.57ms | 17.71s 
 90.000% |  14.61ms | 22.00s 
 99.000% | 142.21ms | 25.71s 
 99.900% | 157.95ms | 25.76s 
 99.990% | 166.65ms | 27.25s 
 99.999% | 169.47ms | 27.26s 
100.000% | 170.11ms | 27.28s 
```

[Allocation profile](get_alloc.html)
[CPU profile](get_cpu.html)

Для `GET` операций картина аналогичная с `PUT` операциями. Посмотрим более подробно на числа:

- 53.32% аллокаций занимает `HttpClient` (перенаправление запроса), 1.93% аллокаций занимает обратботка запроса в текущем инстансе
- 15.11% cpu занимает `HtppClient`, 0.94% cpu занимает обработать запрос в текущем инстансе

## Выводы

В сравнении со вторым этапем производительность сильно снизилась. Как видно из профилей, сетевое взаимодействие между нодами
занимает значительное количество ресурсов, из-за чего уменьшается пропускная способность и увеличивается нагруженность сервера.
Относительно затрат на сетевое взаимодействие, оптимизации бизнес логики приложения не будут давать какого-либо
значительного результата
