# Таразанов Максим, ИТМО ФИТИП, М4139, Stage 3

## Шардирование
При шардировании использовалась 
**Consistent hashing** и хеш-функция **SHA-256**.

Согласованный хеш увеличивает перформанc
за счет равномерного распределения, масштабируем и быстрее.
Весовой хеш при этом имеет сложность, зависющую от логарифма,
но проще реализуемый и подойдёт для меньших систем
(там где не надо будет прогревать огромным количеством данных).

## GET
Тестирование запросов проводилось на показателях из предыдущего этапа.
(хотя rps на пару тысяч тоже держался нормально, но мне кажется,
моё железо как-то странно иногда работает)
В шардированном варианте иногда начали проскакивать ошибки
при запросах. Предположив, что это может быть из-за нехватки мощности ресурсов,
я немного уменьшил количество воркеров и действительно ошибок стало меньше.

В шардированном варианте также улучшилась латенси.

## PUT
Аналогично GET-запросам, тесты были на предыдущих показателях.
Также в новом варианте были некоторые ошибки в запросах и также
их стало меньше при уменьшении количества воркеров.
Также, увеличив в этом моменте TTL, на мой взгляд в логах стало
ещё меньше ошибок. Я пока не могу придумать ещё причины ошибок,
но пока, по-моему, получается убедительный вариант.

Ну и латенси в среднем стало получше.

## Asprof

### CPU
В новой версии уходит очень много процессорного времени при поиске узла.
Нагрузки прошлого этапа процентно (друг относительно друга) не изменились,
поэтому есть предложение маршрутизировать запросы извне
(по типу балансировшик с прокси, шардирование на клиенте)

### Alloc
Очень сильно возрасли аллокации из-за того, что берется нагрузка, по факту, прокси,
и HTTP очень сильно начинает требовать память.

### Lock
Изменений обнаружено не было
