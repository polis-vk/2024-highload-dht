## PUT 30000 30s 8 threads 1000 con

Сначала попробуем проверить, насколько изменилось время обработки запросов с добавлением нового кода.

```
            было        стало
 50.000%  523.78ms      7.02s
 75.000%  954.37ms      8.16s
 90.000%    1.33s       8.93s
 99.000%    1.75s       9.72s
 99.900%    2.04s       9.99s
 99.990%    2.13s       10.12s
 99.999%    2.17s       10.21s
100.000%    2.19s       10.26s
```

Время обработки значительно увеличилось. Одно из предположений: было уменьшено количество ядер для виртуалки.

## PUT 3000 30s 1 thread 1 con

В процессе анализа были выявлены недостатки работы Consistent Hashing, постоянно берется хост 
с наибольшим значением порта. Однако по перцентилям можно отметить увеличение времени обработки запроса, так как
накладываются дополнительные расходы на работу с клиентом.

```
 50.000%   19.32s 
 75.000%   23.40s 
 90.000%   26.05s 
 99.000%   27.61s 
 99.900%   27.69s 
 99.990%   27.71s 
 99.999%   27.71s 
100.000%   27.71s 
```

При анализе графа put-profile-1th-cpu.html можно заметить, что 11% ресурсов уходит на работу клиента.
Также добавляются аллокации клиента put-profile-1th-alloc.html 6%.

Также пришлось уменьшить количество потоков и соединений для проверки работоспособности.

Еще уменьшилось количество запросов. 20000 уже не проходили, из них только около 1700 успевали пройти. 
На 3000 тестирование вроде как работало без ошибок.

## GET 5000 30s 1 thread 1 con

До этого держал нагрузку на 80000 запросов 8 потоков и 1000 соединений.

```
 50.000%   19.55s
 75.000%   23.79s
 90.000%   25.85s
 99.000%   27.34s
 99.900%   27.46s
 99.990%   27.46s
 99.999%   27.46s
100.000%   27.46s
```

По результатам перцентилей с 5000 запросов работает также как с 80000, то есть результатами предыдущего этапа.

## ALLOC

PUT запросы: put-profile-1th-alloc.html.

GET запросы: get-profile-1th-alloc.html.

## CPU

PUT запросы: put-profile-1th-cpu.html.
Воркеры работают с клиентом. Добавился селектор менеджер для управления соединениями клиента. Из расходов: 
работа с responseAsync клиента - 33%; в нем же 25% - работа СompletableFuture.

GET запросы: get-profile-1th-cpu.html.
Добавилась нагрузка на работу с клиентом.

## LOCK

В PUT запросах put-profile-1th-lock.html более 60% занимает работа SelectorManager, который используется http клиент.

В GET запросах get-profile-1th-lock.html около 40% занимает работа SelectorManager.

В основном все изменения, анализируя профили, связаны с тем, что добавились дополнительные расходы на http клиента.

## Улучшения
* Переработать хеш-функцию, так как сейчас распределение данных неравномерное, судя по нагрузочному тестированию